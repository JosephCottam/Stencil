import BrewerPalettes

const CELL_HEIGHT : 100
const LABEL_HEIGHT: 10

canvas Main
   stream Barley(year, site, yield, variety)
   layer Barley[BarleySite]
   guide 
     axis[axisLabel: "Yield", sample: "LINEAR", seed.min: 0, seed.max: 100]
        from BarleySite X
    sidebar[X: 75, Y: -60] 
       from BarleySite STROKE_COLOR

   from Barley
     ID: site
     Y: Sum(CELL_HEIGHT, LABEL_HEIGHT) -> Sort(site) -> Mult(Sum, Sort)
     (year, yield, variety): (year, yield, variety)


canvas BarleySite
  stream SiteValues(year, yield, variety)

  guide title[height: LABEL_HEIGHT, fill: "bisque"] from ID
  
  element Border[SHAPE]
      SHAPE: "RECTANGLE"
  	  (X,Y,HEIGHT, WIDTH): Values[X], Values[Y], Values[HEIGHT], Values[WIDTH]

  layer Values
  guide axis[axisLabel: "Variety"] from SiteValues Y
  from SiteValues
    ID: Concatenate(variety,year)
    PEN_COLOR: BrewerColors[palette: "PuRd"](year)
    X:* yield
    Y:* Sort(variety) ->  Scale[min: LABEL_HEIGHT, max: CELL_HEIGHT](_)
    FILL_COLOR: @Color{CLEAR}
    REGISTRATION: "CENTER"


