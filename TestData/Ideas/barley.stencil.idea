import BrewerPalettes

stream Barley(year, site, yield, variety)
const(CELL_HEIGHT : 100, LABEL_HEIGHT: 10)


canvas Main
  guide 
    axis[axisLabel: "Yield", sample: "LINEAR", seed.min: 0, seed.max: 100] 
    from BarleySite X

  guide 
    sidebar[X: 75, Y: -60] 
    from BarleySite STROKE_COLOR
      example.FILL_COLOR: @Color{GRAY90}


layer Barley[BarleySite]
from Barley
  ID: site
   Y: Sort(site) -> Mult(CELL_HEIGHT)
   (year, yield, variety): (year, yield, variety)


layer BarleySite
  stream SiteValues(year, yield, variety)
  guide axis[axisLabel: "Variety"] from SiteValues Y
  guide title[height: LABEL_HEIGHT, fill: "bisque"] from ID
  
  element Border[SHAPE]
  		(X,Y,HEIGHT, WIDTH): SiteValues[X], SiteValues[Y], SiteValues[HEIGHT] ,SiteValues[WIDTH]

  layer Values
  from SiteValues
    ID: Concatenate(variety,year)
    PEN_COLOR: BrewerColors[palette: "PuRd"](year)
    X:* yield
    Y:* Sort(variety) ->  Scale[min: LABEL_HEIGHT, max: CELL_HEIGHT](_)
    FILL_COLOR: @Color{CLEAR}
    REGISTRATION: "CENTER"


