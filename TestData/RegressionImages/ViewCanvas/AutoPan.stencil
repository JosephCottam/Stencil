STREAM: File
NAME: Stocks
TUPLE_SIZE: 6
SEPARATOR: ,
SOURCE: /Volumes/scratch/jcottam/Stencil/Stencil/TestData/RegressionImages/ViewCanvas/google_stocks.csv
SKIP: 1
STRICT: true
STREAM: Mouse
NAME: Mouse
FREQUENCY: -2147483648

import ViewCanvas
import Dates

stream Stocks(Date, Open)
stream Mouse(X, Y, BUTTON, SCREEN_X, SCREEN_Y, DELTA_X, DELTA_Y, CLICK_COUNT, CTRL, ALT, SHIFT, META, TYPE)

order (Stocks | Mouse)

stream AlignedStocks(Date, Open)
from Stocks
  Date : Parse[f:"dd-MMM-yy"](Date)
  Open : Open

view 
from AlignedStocks
    (HEIGHT, Y) : (canvas.HEIGHT, canvas.Y)
from AlignedStocks
    filter(prefilter.Margin < 50)
    filter(prefilter.TimeStep < prefilter.RIGHT)
    prefilter(TimeStep, Margin, RIGHT) : 
        [Right] TranslateRegistration("TOP_LEFT", view.X, view.Y, view.WIDTH, view.HEIGHT, "RIGHT") ->
        [Time] TimeStep(Date) -> Sub(Right.X, _) -> (Time.VALUE, Sub, Right.X) 
    
    X: Add(3, view.X)
from Mouse
    filter(BUTTON = 1)
    X : [dim] ScreenToCanvasDimension(DELTA_X,0) -> Sub(view.X, dim.Width)


layer Ticker["POLY_POINT"]
guide axis[implant:"POINT"] Linear from Y
         label.FONT: Font{20}
      axis[unit: "MONTH", implant:"POINT"] Date from X
		   label.TEXT: Parse.format[f:"MMM yy"](Input)
         label.FONT: Font{20}
from AlignedStocks
    ID: Count()
    GROUP : "Google"   
    X: TimeStep(Date) 
    Y: Open
    PEN: Stroke{1}
    PEN_COLOR: Color{BLUE}



operator TimeStep (Date) -> (VALUE)
    default => VALUE : Index(Date) -> Mult(3, Index)
