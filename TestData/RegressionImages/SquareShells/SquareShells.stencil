stream Layout(ID, X, Y) from Text["./squarified_10K.txt", sep="\\s+"]

layer Nodes
from Layout
    ID: ID
    (X,Y) :* Range[ALL](@Max, ID) -> Sub(_, ID)  -> Layout(ID)
    FILL_COLOR:* HeatScale[](ID)
/*  (X,Y) : Layout(ID) 
    FILL_COLOR: Color{RED} */
    SIZE: 1

operator Layout (i) -> (X,Y) 
    default => (X,Y): Sqrt(i) -> 
                [shell] Floor(_) ->
                [n] Add1(_) -> Pow(n,2) -> 
                [center] Sub(_, n) -> 
                ByOdds(i,shell,center) -> 
                Negate(ByOdds.y) ->
                (ByOdds.x, _)
       

operator ByOdds (i,shell,center) -> (x,y)
    (i < center) => (x,y) : Pow(shell,2) -> Sub(i, _) -> (shell,_)
    (i > center) => (x,y) : Sub(i, center) -> Sub(shell, _) -> (_,shell)
    default => (x,y) : (shell,shell)

