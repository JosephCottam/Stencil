STREAM: File
NAME: EntityFeed
HEADER: ID X Y
SEPARATOR: \s+
SOURCE: /Volumes/scratch/jcottam/workspace/Stencil/Stencil/TestData/RegressionImages/Sourceforge/vx_cluster_0_8.6_min_cuts.coord
SKIP: 0
STRICT: true


/*Layout for turning a linear sequence into a square.
  Each number is assigned a "shell" based on the square root of the value.
  Shells are filled top-down, the right-to-left.
*/

stream EntityFeed(ID, X,Y)  /*Precomputed layout*/


layer Nodes
from EntityFeed
	SIZE: 1
	ID: Counter()
	(X,Y) : Counter() -> [v] Sub(_,1) -> Layout(_) 

operator Layout (i) -> (X,Y) 
	ALL => (X,Y): Sqrt(i) -> 
	            [shell] Floor(_) ->
				[n] Add(1,_) -> Pow(n[_],2) -> 
				[center] Sub(_, n[_]) -> 
				ByOdds(i,shell[_],center[_]) 

operator ByOdds (i,shell,center) -> (x,y)
	(i < center) => (x,y) : Pow(shell,2) -> Sub(i, _) -> (shell,_)
	(i > center) => (x,y) : Sub(i, center) -> Sub(shell, _) -> (_,shell)
	(i = center) => (x,y) : (shell,shell)
