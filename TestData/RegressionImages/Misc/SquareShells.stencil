STREAM: File
NAME: EntityFeed
HEADER: ID X Y
SEPARATOR: \s+
SOURCE: /Volumes/scratch/jcottam/workspace/Stencil/Stencil/TestData/RegressionImages/Sourceforge/vx_cluster_0_8.6_min_cuts.coord
SKIP: 0
STRICT: true


/*Layout for turning a linear sequence into a square.
  Each number is assigned a "shell" based on the square root of the value.
  Shells are filled top-down, the right-to-left.
*/

external stream EntityFeed(ID, X,Y)  /*Precomputed layout*/


layer Nodes
from EntityFeed
	SIZE: 1
	ID: Count("")
	(X,Y) : Count("") -> Sub(_,1) -[v]> Layout(_) 

operator Layout (i) -> (X,Y) 
	all => (X,Y): Sqrt(i) -> Floor(_) -[shell]>
				Add(1,_) -[n]>
				Pow(n[_],2) -> Sub(_, n[_]) -[center]> 
				ByOdds(i,shell[_],center[_]) 

operator ByOdds (i,shell,center) -> (x,y)
	(i < center) => (x,y) : Pow(shell,2) -> Sub(i, _) -> (shell,_)
	(i > center) => (x,y) : Sub(i, center) -> Sub(shell, _) -> (_,shell)
	(i = center) => (x,y) : (shell,shell)
