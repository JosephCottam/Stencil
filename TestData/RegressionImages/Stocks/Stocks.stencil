STREAM: File
NAME: Stocks
HEADER: Date,Open,High,Low,Close,Volume
SEPARATOR: ,
SOURCE: ./google_stocks.csv
SKIP: 1
STRICT: true

stream Stocks(Date, Open)

layer Ticker["POLY_LINE"]		/*Poly-line is a set of line segments treated as a group.*/
guide
  axis from XS
  axis Linear from YS

from Stocks
	ID: "Google"
   IDX: "after"
	XS: TimeStep(Date)           /*Indicates that a new segment of a poly-line is to be crated.*/
	YS: Price(Open)         		/*All news in a block indicate the same extension until a new input is started.*/
	PEN: @Stroke{1}
	PEN_COLOR: @Color{BLUE}

layer Averages["POLY_LINE"]
from Stocks
	ID: "Google_30"
   IDX: "after"
	XS: TimeStep(Date)
	YS: Price(Open) -> Range["-30..n"](@Mean, Price)	    /*Average the most recent 30 values.*/
	PEN: @Stroke{1}
	PEN_COLOR: @Color{LIME,150}
from Stocks
	ID: "Google_ALL"
   IDX: "after"
	XS: TimeStep(Date)
	YS: Price(Open) -> Range[ALL](@Mean, Price)		    /*Average all values.*/
	PEN: @Stroke{1}
	PEN_COLOR: @Color{CRIMSON,150}
from Stocks
	ID: "Google_20"
   IDX: "after"
	XS: TimeStep(Date)
	YS: Price(Open) -> Range["-30 .. -10"](@Mean, Price) /*Average that lags by 10 and includes 20 values.*/
	PEN: @Stroke{1}
	PEN_COLOR: @Color{ORANGE,150}
	

operator Price (Open) -> (Price)
	ALL => (Price) : Mult(-1, Open)

operator TimeStep (T) -> (VALUE)
	ALL => (VALUE) :  Index(T) -> Mult(_, 3)
