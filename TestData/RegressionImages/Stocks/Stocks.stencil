STREAM: File
NAME: Stocks
HEADER: Date,Open,High,Low,Close,Volume
SEPARATOR: ,
SOURCE: ./google_stocks.csv
CHECKHEADER: true

external stream Stocks(Date, Open)

layer Ticker[POLY_LINE]					/*Poly-line is a set of line segments treated as a group.*/
from Stocks
	ID: "Google"
	X.new: TimeStep(Date) -> (VALUE) /*Indicates that a new segment of a poly-line is to be crated.*/
	Y.new: Price(Open) -> (Price)		/*All news in a block indicate the same extension until a new input is started.*/
	STROKE_WEIGHT: 1
	STROKE_COLOR: @color(BLUE)

layer Averages[POLY_LINE]
from Stocks
	ID: "Google_30"
	X.new: TimeStep(Date) -> (VALUE)
	Y.new: Price(Open) -> Mean[-30..n](Price) -> (VALUE)	/*Average the most recent 30 values.*/
	(STROKE_WEIGHT, STROKE_COLOR): (1, @color(LIME,150))
from Stocks
	ID: "Google_ALL"
	X.new: TimeStep(Date) -> (VALUE)
	Y.new: Price(Open) -> Mean[1..n](Price) -> (VALUE)		/*Average all values.*/
	(STROKE_WEIGHT, STROKE_COLOR): (1, @color(CRIMSON,150))
from Stocks
	ID: "Google_20"
	X.new: TimeStep(Date) -> (VALUE)
	Y.new: Price(Open) -> Mean[-30 .. -10](Price) -> (VALUE) /*Average that lags by 10 and includes 20 values.*/
	(STROKE_WEIGHT, STROKE_COLOR): (1, @color(ORANGE,150))

legend Price (Open) -> (Price)
	all => (Price) : Mult(-1, Open) -> (VALUE)

legend TimeStep (T) -> (VALUE)
	all => (VALUE) :  Index(T) -> Mult(VALUE, 3) -> VALUE
