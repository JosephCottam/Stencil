STREAM: File
NAME: Stocks
TUPLE_SIZE: 6
SEPARATOR: ,
SOURCE: ./google_stocks.csv
SKIP: 1
STRICT: true

stream Stocks(Date, Open)

layer Ticker["POLY_POINT"]		/*Poly-line is a set of line segments treated as a group.*/
guide
   axis from X
   axis from Y

from Stocks
   ID: Ids()
   GROUP: "Google"
   ORDER: Count()
   X: TimeStep(Date)
   Y: Open  
   PEN: @Stroke{1}
   PEN_COLOR: @Color{BLUE}

layer Averages["POLY_POINT"]
from Stocks
   ID: Ids()
   GROUP: "Google_30"
   ORDER: Count()
   X: TimeStep(Date)
   Y: Range["-30..n"](@Mean, Open)	    /*Average the most recent 30 values.*/
   PEN: @Stroke{1}
   PEN_COLOR: @Color{LIME,150}
from Stocks
   ID: Ids()
   GROUP: "Google_ALL"
   ORDER: Count()
   X: TimeStep(Date)
   Y: Range[ALL](@Mean, Open)		    /*Average all values.*/
   PEN: @Stroke{1}
   PEN_COLOR: @Color{CRIMSON,150}
from Stocks
   ID: Ids()
   GROUP: "Google_20"
   ORDER: Count()
   X: TimeStep(Date)
   Y: Range["-30 .. -10"](@Mean, Open) /*Average that lags by 10 and includes 20 values.*/
   PEN: @Stroke{1}
   PEN_COLOR: @Color{ORANGE,150}

operator Ids : Count

operator TimeStep (T) -> (VALUE)
	default => (VALUE) :  Index(T) -> Mult(_, 3)
