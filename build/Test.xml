 <project name="TestStencil" default="RunTests">
    <target name="RunTests" depends="JUnit"/>
    
    <target name="CleanUpTests">
        <delete><fileset dir="testResults" includes="**/TEST_*"/></delete>
    </target>
    
    <target name="MakeJar">
       <ant antfile="./build/Deploy.xml" inheritRefs="true" target="CompiledJar"/>
    </target>
    
    <target name="OneTest" depends="CleanUpTests,MakeJar">
        <property name="results" location="./testResults/" />

        <move file="Stencil.jar" toDir="TestData"/>
        <delete dir="${results}"/>
        <mkdir dir="${results}"/>

        
        <junit fork="yes" dir="/Users/jcottam/Documents/workspace/Stencil/Stencil/">
            <formatter type="plain"/>

            <classpath>
                <pathelement location="./TestData/Stencil.jar"/>
                <pathelement path="${java.class.path}"/>
                <pathelement path="."/>
                <fileset dir="${runtimeLibrary}" includes="*.jar"/>
            </classpath>
            
            <batchtest todir="${results}">
                <fileset dir="/Users/jcottam/Documents/workspace/Stencil/Stencil/bin/">
                    <include name="**/*TestMetadataDefs.class"/>
                </fileset>
            </batchtest>
        </junit>
        
        <delete file="TestData/Stencil.jar"/>
    </target>
    
    <target name="JUnit" depends="CleanUpTests,MakeJar">
        <property name="results" location="./testResults/" />

        <move file="Stencil.jar" toDir="TestData"/>
        <delete dir="${results}"/>
        <mkdir dir="${results}"/>

        
        <junit fork="yes" dir="/Users/jcottam/Documents/workspace/Stencil/Stencil/">
            <formatter type="brief"/>

            <classpath>
                <pathelement location="./TestData/Stencil.jar"/>
                <pathelement path="${java.class.path}"/>
                <pathelement path="."/>
                <fileset dir="${runtimeLibrary}" includes="*.jar"/>
            </classpath>
            
            
            <batchtest todir="${results}">
                <fileset dir="/Users/jcottam/Documents/workspace/Stencil/Stencil/bin/">
                    <include name="**/*Test*.class"/>
                    <exclude name="**/*$*"/>
                    <exclude name="**/testUtilities/**"/>
                    <exclude name="**/examples/**"/>
                    <exclude name="**/StencilTestCase.*"/>
                </fileset>
            </batchtest>
        </junit>
        
        <delete file="TestData/Stencil.jar"/>
    </target>


    <target name="JUnit-Singles" depends="CleanUpTests,MakeJar">
        <move file="Stencil.jar" toDir="TestData"/>
        
        <junit fork="yes" dir="/Users/jcottam/Documents/workspace/Stencil/Stencil/">
            <classpath>
                <pathelement location="./TestData/Stencil.jar"/>
                <pathelement path="${testsLocation}"/>
                <pathelement path="${java.class.path}"/>
                <pathelement path="."/>
                <fileset dir="${runtimeLibrary}" includes="*.jar"/>
            </classpath>
            <test name="stencil.unittests.TestConfigure"/>
            <formatter type="plain"/>
        </junit>
    </target>


	<!--GUnit tests--> 	
 	<target name="GUnit"> 
	 	<property name="testsLocation" location="bin/stencil/unittests/parser/string/grammars/" />

		<jar jarfile="${runtimeLibrary}/Stencil.jar" includes="*.class" basedir=".">
			<fileset dir="bin"/>
		</jar>

		<java classname="org.antlr.gunit.Interp" fork="yes" dir="${target}">
			<classpath>
				<pathelement path="${testsLocation}"/>
				<pathelement path="${java.class.path}"/>
				<pathelement path="."/>
			    <fileset dir="${runtimeLibrary}" includes="*.jar"/>
			</classpath>
			<arg value="${testsLocation}/Stencil.gunit"/>
		</java>
		<java classname="org.antlr.gunit.Interp" fork="yes" dir="${target}">
			<classpath>
				<pathelement path="${testsLocation}"/>
				<pathelement path="${java.class.path}"/>
				<pathelement path="."/>
			    <fileset dir="${runtimeLibrary}" includes="*.jar"/>
			</classpath>
			<arg value="${testsLocation}/SigilArgs.gunit"/>
		</java>
 		
 		<delete file="${runtimeLibrary}/Stencil.jar"/>
	</target>
 </project>